<!DOCTYPE html>
<!-- SPDX-License-Identifier: MIT -->
<!-- Copyright (c) 2026 Tom F. (https://github.com/tomtom215/duckdb-behavioral) -->
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DuckDB Behavioral Analytics - Interactive Demo</title>
<style>
  :root {
    --bg: #0d1117; --surface: #161b22; --border: #30363d;
    --text: #c9d1d9; --text-muted: #8b949e; --accent: #58a6ff;
    --green: #3fb950; --yellow: #d29922; --red: #f85149;
    --code-bg: #1c2128;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
    background: var(--bg); color: var(--text); line-height: 1.6;
  }
  .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
  h1 { font-size: 28px; margin-bottom: 8px; }
  h1 span { color: var(--accent); }
  .subtitle { color: var(--text-muted); margin-bottom: 32px; font-size: 16px; }
  .note {
    background: #1a2332; border: 1px solid #1f4070; border-radius: 6px;
    padding: 12px 16px; margin-bottom: 24px; font-size: 14px; color: #79c0ff;
  }
  .tabs {
    display: flex; gap: 4px; border-bottom: 1px solid var(--border);
    margin-bottom: 0; overflow-x: auto;
  }
  .tab {
    padding: 8px 16px; border: none; background: none; color: var(--text-muted);
    cursor: pointer; font-size: 14px; border-bottom: 2px solid transparent;
    white-space: nowrap; font-family: inherit;
  }
  .tab:hover { color: var(--text); }
  .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
  .panel { display: none; }
  .panel.active { display: block; }
  .example {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 6px; margin: 16px 0; overflow: hidden;
  }
  .example-header {
    padding: 12px 16px; border-bottom: 1px solid var(--border);
    display: flex; align-items: center; gap: 8px;
  }
  .example-header h3 { font-size: 15px; flex: 1; }
  .badge {
    font-size: 11px; padding: 2px 8px; border-radius: 10px;
    font-weight: 600;
  }
  .badge-fn { background: #1f3a5f; color: var(--accent); }
  .badge-ref { background: #2a1f0a; color: var(--yellow); }
  .example-body { padding: 16px; }
  .description { color: var(--text-muted); font-size: 14px; margin-bottom: 12px; }
  pre {
    background: var(--code-bg); border: 1px solid var(--border);
    border-radius: 6px; padding: 16px; overflow-x: auto;
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
    font-size: 13px; line-height: 1.5;
  }
  .sql { color: var(--text); }
  .kw { color: #ff7b72; }
  .fn { color: #d2a8ff; }
  .str { color: #a5d6ff; }
  .num { color: #79c0ff; }
  .cm { color: var(--text-muted); }
  .result-label {
    color: var(--text-muted); font-size: 12px; margin: 12px 0 4px;
    text-transform: uppercase; letter-spacing: 0.5px;
  }
  .result-table {
    width: 100%; border-collapse: collapse; font-size: 13px;
    font-family: 'SFMono-Regular', Consolas, monospace;
  }
  .result-table th {
    text-align: left; padding: 6px 12px; border-bottom: 2px solid var(--border);
    color: var(--text-muted); font-weight: 600;
  }
  .result-table td {
    padding: 6px 12px; border-bottom: 1px solid var(--border);
  }
  .result-table tr:last-child td { border-bottom: none; }
  .result-table tr:hover td { background: rgba(88,166,255,0.05); }
  .val-true { color: var(--green); }
  .val-false { color: var(--red); }
  .val-null { color: var(--text-muted); font-style: italic; }
  .val-num { color: var(--accent); }
  .install {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 6px; padding: 16px; margin-top: 24px;
  }
  .install h3 { margin-bottom: 8px; font-size: 15px; }
  footer {
    margin-top: 48px; padding-top: 16px; border-top: 1px solid var(--border);
    color: var(--text-muted); font-size: 13px; text-align: center;
  }
  footer a { color: var(--accent); text-decoration: none; }
</style>
</head>
<body>
<div class="container">

<h1><span>behavioral</span> DuckDB Extension</h1>
<p class="subtitle">ClickHouse-compatible behavioral analytics functions for DuckDB</p>

<div class="note">
  This extension provides 7 aggregate functions for user behavior analysis:
  sessionization, retention cohorts, conversion funnels, sequence pattern matching, and more.
  All functions match ClickHouse semantics for easy migration.
</div>

<div class="tabs" id="tabs">
  <button class="tab active" data-panel="sessions">Sessions</button>
  <button class="tab" data-panel="retention">Retention</button>
  <button class="tab" data-panel="funnel">Funnels</button>
  <button class="tab" data-panel="sequence">Sequences</button>
  <button class="tab" data-panel="events">Event Mining</button>
  <button class="tab" data-panel="git">Git Mining</button>
  <button class="tab" data-panel="install">Install</button>
</div>

<!-- Sessions -->
<div class="panel active" id="sessions">
<div class="example">
  <div class="example-header">
    <h3>User Work Session Detection</h3>
    <span class="badge badge-fn">sessionize</span>
    <span class="badge badge-ref">Eyolfson et al., MSR 2011</span>
  </div>
  <div class="example-body">
    <p class="description">Assign session IDs to events based on inactivity gaps. Events within the timeout window belong to the same session.</p>
<pre class="sql"><span class="kw">SELECT</span> author, commit_time,
    <span class="fn">sessionize</span>(commit_time, <span class="kw">INTERVAL</span> <span class="str">'4 hours'</span>)
        <span class="kw">OVER</span> (<span class="kw">PARTITION BY</span> author <span class="kw">ORDER BY</span> commit_time)
        <span class="kw">AS</span> work_session
<span class="kw">FROM</span> git_commits
<span class="kw">ORDER BY</span> author, commit_time;</pre>
    <p class="result-label">Result</p>
    <table class="result-table">
      <tr><th>author</th><th>commit_time</th><th>work_session</th></tr>
      <tr><td>alice</td><td>2024-03-15 09:00</td><td class="val-num">0</td></tr>
      <tr><td>alice</td><td>2024-03-15 09:45</td><td class="val-num">0</td></tr>
      <tr><td>alice</td><td>2024-03-15 10:30</td><td class="val-num">0</td></tr>
      <tr><td>alice</td><td>2024-03-15 16:00</td><td class="val-num">1</td></tr>
      <tr><td>bob</td><td>2024-03-15 14:00</td><td class="val-num">0</td></tr>
      <tr><td>bob</td><td>2024-03-16 10:00</td><td class="val-num">1</td></tr>
    </table>
  </div>
</div>
</div>

<!-- Retention -->
<div class="panel" id="retention">
<div class="example">
  <div class="example-header">
    <h3>Contributor Retention Cohort Analysis</h3>
    <span class="badge badge-fn">retention</span>
    <span class="badge badge-ref">Casalnuovo et al., ESEC/FSE 2015</span>
  </div>
  <div class="example-body">
    <p class="description">Track whether users remain active in subsequent periods. Each boolean in the result indicates retention for that period.</p>
<pre class="sql"><span class="kw">SELECT</span> author,
    <span class="fn">retention</span>(
        active_month = first_month,
        active_month = first_month + <span class="num">1</span>,
        active_month = first_month + <span class="num">2</span>,
        active_month = first_month + <span class="num">3</span>
    ) <span class="kw">AS</span> retained
<span class="kw">FROM</span> developer_activity
<span class="kw">GROUP BY</span> author;</pre>
    <p class="result-label">Result</p>
    <table class="result-table">
      <tr><th>author</th><th>retained</th></tr>
      <tr><td>alice</td><td>[<span class="val-true">true</span>, <span class="val-true">true</span>, <span class="val-true">true</span>, <span class="val-false">false</span>]</td></tr>
      <tr><td>bob</td><td>[<span class="val-true">true</span>, <span class="val-true">true</span>, <span class="val-false">false</span>, <span class="val-false">false</span>]</td></tr>
      <tr><td>carol</td><td>[<span class="val-true">true</span>, <span class="val-true">true</span>, <span class="val-true">true</span>, <span class="val-false">false</span>]</td></tr>
    </table>
  </div>
</div>
</div>

<!-- Funnel -->
<div class="panel" id="funnel">
<div class="example">
  <div class="example-header">
    <h3>PR Lifecycle Funnel</h3>
    <span class="badge badge-fn">window_funnel</span>
    <span class="badge badge-ref">Gousios et al., ICSE 2014</span>
  </div>
  <div class="example-body">
    <p class="description">Model a conversion funnel: how far does each user progress through ordered steps within a time window? Returns the furthest step reached.</p>
<pre class="sql"><span class="kw">SELECT</span> author,
    <span class="fn">window_funnel</span>(
        <span class="kw">INTERVAL</span> <span class="str">'24 hours'</span>,
        event_time,
        event_type = <span class="str">'pr_opened'</span>,
        event_type = <span class="str">'first_review'</span>,
        event_type = <span class="str">'approved'</span>,
        event_type = <span class="str">'merged'</span>
    ) <span class="kw">AS</span> pr_funnel_step
<span class="kw">FROM</span> pr_events
<span class="kw">GROUP BY</span> author;</pre>
    <p class="result-label">Result</p>
    <table class="result-table">
      <tr><th>author</th><th>pr_funnel_step</th></tr>
      <tr><td>alice</td><td class="val-num">1</td></tr>
      <tr><td>bob</td><td class="val-num">1</td></tr>
      <tr><td>carol</td><td class="val-num">1</td></tr>
    </table>
    <p class="description" style="margin-top:12px">Supports 6 combinable modes: <code>strict</code>, <code>strict_order</code>, <code>strict_deduplication</code>, <code>strict_increase</code>, <code>strict_once</code>, <code>allow_reentry</code>.</p>
  </div>
</div>
</div>

<!-- Sequence -->
<div class="panel" id="sequence">
<div class="example">
  <div class="example-header">
    <h3>Bug-Introducing Commit Pattern Detection</h3>
    <span class="badge badge-fn">sequence_match</span>
    <span class="badge badge-ref">Eyolfson et al., MSR 2011</span>
  </div>
  <div class="example-body">
    <p class="description">Match regex-like patterns over event sequences. Detect: large commit (&gt;500 LOC) followed by bug-fix within 7 days.</p>
<pre class="sql"><span class="kw">SELECT</span> author,
    <span class="fn">sequence_match</span>(
        <span class="str">'(?1)(?t&lt;=604800)(?2)'</span>,
        commit_time,
        lines_changed > <span class="num">500</span>,
        is_bug_fix
    ) <span class="kw">AS</span> has_bug_pattern
<span class="kw">FROM</span> git_commits
<span class="kw">GROUP BY</span> author;</pre>
    <p class="result-label">Result</p>
    <table class="result-table">
      <tr><th>author</th><th>has_bug_pattern</th></tr>
      <tr><td>alice</td><td class="val-true">true</td></tr>
      <tr><td>bob</td><td class="val-true">true</td></tr>
    </table>
  </div>
</div>

<div class="example">
  <div class="example-header">
    <h3>CI/CD Failure Cycle Count</h3>
    <span class="badge badge-fn">sequence_count</span>
    <span class="badge badge-ref">Vasilescu et al., ICSE 2014</span>
  </div>
  <div class="example-body">
    <p class="description">Count non-overlapping occurrences of push &rarr; ci_failure &rarr; push cycles per developer.</p>
<pre class="sql"><span class="kw">SELECT</span> author,
    <span class="fn">sequence_count</span>(
        <span class="str">'(?1)(?2)(?3)'</span>,
        event_time,
        event_type = <span class="str">'push'</span>,
        event_type = <span class="str">'ci_failure'</span>,
        event_type = <span class="str">'push'</span>
    ) <span class="kw">AS</span> fail_fix_cycles
<span class="kw">FROM</span> ci_events
<span class="kw">GROUP BY</span> author;</pre>
    <p class="result-label">Result</p>
    <table class="result-table">
      <tr><th>author</th><th>fail_fix_cycles</th></tr>
      <tr><td>alice</td><td class="val-num">0</td></tr>
      <tr><td>bob</td><td class="val-num">2</td></tr>
    </table>
  </div>
</div>
</div>

<!-- Events -->
<div class="panel" id="events">
<div class="example">
  <div class="example-header">
    <h3>PR Review-to-Merge Timeline</h3>
    <span class="badge badge-fn">sequence_match_events</span>
    <span class="badge badge-ref">Gousios et al., ICSE 2014</span>
  </div>
  <div class="example-body">
    <p class="description">Extract timestamps of each matched step in a sequence pattern. Returns a list of timestamps for the condition steps.</p>
<pre class="sql"><span class="kw">SELECT</span> pr_id,
    <span class="fn">sequence_match_events</span>(
        <span class="str">'(?1)(?2)(?3)(?4)'</span>,
        event_time,
        event_type = <span class="str">'pr_opened'</span>,
        event_type = <span class="str">'first_review'</span>,
        event_type = <span class="str">'approved'</span>,
        event_type = <span class="str">'merged'</span>
    ) <span class="kw">AS</span> lifecycle_timestamps
<span class="kw">FROM</span> pr_events
<span class="kw">GROUP BY</span> pr_id;</pre>
    <p class="result-label">Result</p>
    <table class="result-table">
      <tr><th>pr_id</th><th>lifecycle_timestamps</th></tr>
      <tr><td>1001</td><td>[03-15 10:00, 03-15 14:30, 03-16 09:00, 03-16 10:00]</td></tr>
      <tr><td>1002</td><td>[03-15 11:00, 03-15 11:30, 03-15 12:00, 03-15 12:15]</td></tr>
      <tr><td>1003</td><td>[]</td></tr>
    </table>
  </div>
</div>

<div class="example">
  <div class="example-header">
    <h3>File Co-Change Pattern Mining</h3>
    <span class="badge badge-fn">sequence_next_node</span>
    <span class="badge badge-ref">Gall et al., ICSM 1998</span>
  </div>
  <div class="example-body">
    <p class="description">Find what event value follows a pattern match. Discover which file developers modify after touching src/parser.rs.</p>
<pre class="sql"><span class="kw">SELECT</span> author,
    <span class="fn">sequence_next_node</span>(
        <span class="str">'forward'</span>, <span class="str">'first_match'</span>,
        commit_time, file_path,
        file_path = <span class="str">'src/parser.rs'</span>,
        file_path = <span class="str">'src/parser.rs'</span>
    ) <span class="kw">AS</span> next_file
<span class="kw">FROM</span> file_changes
<span class="kw">GROUP BY</span> author;</pre>
    <p class="result-label">Result</p>
    <table class="result-table">
      <tr><th>author</th><th>next_file</th></tr>
      <tr><td>alice</td><td>src/executor.rs</td></tr>
      <tr><td>bob</td><td>src/ast.rs</td></tr>
      <tr><td>carol</td><td class="val-null">NULL</td></tr>
    </table>
  </div>
</div>
</div>

<!-- Git Mining -->
<div class="panel" id="git">
<div class="example">
  <div class="example-body">
    <p class="description">All 7 examples above are grounded in published software engineering research. The extension turns DuckDB into a behavioral analytics engine for git repository mining, product analytics, and user behavior analysis.</p>
    <p class="result-label">Academic References</p>
    <table class="result-table">
      <tr><th>Function</th><th>Use Case</th><th>Reference</th></tr>
      <tr><td><code>sessionize</code></td><td>Work session detection</td><td>Eyolfson, Tan, Lam. MSR 2011</td></tr>
      <tr><td><code>retention</code></td><td>Contributor cohorts</td><td>Casalnuovo et al. ESEC/FSE 2015</td></tr>
      <tr><td><code>window_funnel</code></td><td>Onboarding funnels</td><td>Casalnuovo et al. ESEC/FSE 2015</td></tr>
      <tr><td><code>sequence_match</code></td><td>Bug pattern detection</td><td>Eyolfson et al. MSR 2011</td></tr>
      <tr><td><code>sequence_count</code></td><td>CI/CD failure cycles</td><td>Vasilescu et al. ICSE 2014</td></tr>
      <tr><td><code>sequence_match_events</code></td><td>PR lifecycle mining</td><td>Gousios et al. ICSE 2014</td></tr>
      <tr><td><code>sequence_next_node</code></td><td>File co-change patterns</td><td>Gall, Hajek, Jazayeri. ICSM 1998</td></tr>
    </table>
  </div>
</div>
</div>

<!-- Install -->
<div class="panel" id="install">
<div class="install">
  <h3>Quick Start (Community Extension)</h3>
<pre class="sql"><span class="cm">-- Install from DuckDB Community Extensions</span>
<span class="kw">INSTALL</span> behavioral <span class="kw">FROM</span> community;
<span class="kw">LOAD</span> behavioral;

<span class="cm">-- Try it out</span>
<span class="kw">SELECT</span> <span class="fn">sessionize</span>(ts, <span class="kw">INTERVAL</span> <span class="str">'30 minutes'</span>)
    <span class="kw">OVER</span> (<span class="kw">ORDER BY</span> ts)
<span class="kw">FROM</span> events;</pre>
</div>

<div class="install" style="margin-top:16px">
  <h3>Build from Source</h3>
<pre class="sql"><span class="cm">-- Build from source</span>
cargo build --release

<span class="cm">-- Load locally-built extension (requires -unsigned)</span>
duckdb -unsigned
<span class="kw">LOAD</span> <span class="str">'target/release/libbehavioral.so'</span>;</pre>
</div>

<div class="install" style="margin-top:16px">
  <h3>All Functions</h3>
  <table class="result-table">
    <tr><th>Function</th><th>Returns</th><th>Description</th></tr>
    <tr><td><code>sessionize(ts, interval)</code></td><td>BIGINT</td><td>Window function: session IDs</td></tr>
    <tr><td><code>retention(bool, ...)</code></td><td>BOOLEAN[]</td><td>Cohort retention analysis</td></tr>
    <tr><td><code>window_funnel(interval, ts, bool, ...)</code></td><td>INTEGER</td><td>Conversion funnel tracking</td></tr>
    <tr><td><code>sequence_match(pattern, ts, bool, ...)</code></td><td>BOOLEAN</td><td>Pattern matching over events</td></tr>
    <tr><td><code>sequence_count(pattern, ts, bool, ...)</code></td><td>BIGINT</td><td>Count pattern matches</td></tr>
    <tr><td><code>sequence_match_events(pattern, ts, bool, ...)</code></td><td>TIMESTAMP[]</td><td>Matched step timestamps</td></tr>
    <tr><td><code>sequence_next_node(dir, base, ts, val, bool, ...)</code></td><td>VARCHAR</td><td>Next value after pattern match</td></tr>
  </table>
</div>
</div>

</div>

<footer>
  <a href="https://github.com/tomtom215/duckdb-behavioral">github.com/tomtom215/duckdb-behavioral</a>
  &mdash; ClickHouse-compatible behavioral analytics for DuckDB
</footer>

<script>
document.getElementById('tabs').addEventListener('click', e => {
  if (!e.target.classList.contains('tab')) return;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  e.target.classList.add('active');
  document.getElementById(e.target.dataset.panel).classList.add('active');
});
</script>
</body>
</html>
